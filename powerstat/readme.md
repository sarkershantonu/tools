# Install (ubuntu) 

``` 
sudo apt install -y  powerstat
``` 

### Monitoring 

- Monitor for basic power usages , 60 sample 1s interval 

```powerstat -R -c -z``` 

The CLI will show this 

``` 

root@pve:~# powerstat -R -c -z
Running for 60.0 seconds (60 samples at 1.0 second intervals).
Power measurements will start in 0 seconds time.

  Time    User  Nice   Sys  Idle    IO  Run Ctxt/s  IRQ/s Fork Exec Exit  Watts
02:05:21   0.2   0.0   0.2  99.6   0.0    1   3954   3563    0    0    0  21.67 
02:05:22   0.3   0.0   0.5  99.0   0.2    1   4574   3658   17   17   17  22.23 
02:05:23   0.3   0.0   0.2  99.5   0.0    2   3654   3546    0    0    0  21.80 
02:05:24   0.8   0.0   0.7  98.5   0.0    3   6769   3888   16    7   15  23.68 
02:05:25   0.5   0.0   0.5  98.9   0.1    1   4892   4026   10    5   11  23.99 
02:05:26   0.2   0.0   0.2  99.6   0.0    3   3970   3236    0    0    0  21.85 
02:05:27   0.2   0.0   0.3  99.4   0.1    1   3585   3501    0    0    1  21.75 
02:05:28   0.2   0.0   0.3  99.4   0.2    1   3748   3428    0    0    0  21.78 
02:05:29   0.3   0.0   0.3  99.5   0.0    1   4410   3512    0    0    0  22.03 
02:05:30   0.3   0.0   0.2  99.5   0.0    1   5544   4337    0    0    0  21.72 
02:05:31   0.3   0.0   0.2  99.5   0.0    1   3192   3669    0    0    0  21.55 
02:05:32   0.2   0.0   0.4  99.4   0.0    1   4044   3616   17   17   17  22.45 
02:05:33   0.2   0.0   0.3  99.5   0.0    1   4039   3521    0    0    0  21.81 
02:05:34   0.2   0.0   0.3  99.5   0.0    1   4147   3463    0    0    0  21.65 
02:05:35   0.8   0.0   1.0  98.1   0.1    1   7257   4102   26   12   26  25.22 
02:05:36   0.2   0.0   0.3  99.5   0.0    1   3910   3422    0    0    0  21.61 
02:05:37   0.4   0.0   0.2  99.4   0.0    1   3736   3466    0    0    0  22.00 
02:05:38   0.3   0.0   0.3  99.2   0.3    1   4076   3497    0    0    0  22.14 
02:05:39   0.3   0.0   0.3  99.3   0.0    1   4272   3607    1    0    0  22.54 
02:05:40   0.3   0.0   0.4  99.3   0.0    1   5502   4656    0    0    1  21.96 
02:05:41   0.3   0.0   0.4  99.3   0.0    1   3760   3720    0    0    0  21.92 
02:05:42   0.5   0.0   0.6  98.9   0.0    1   4613   3945   18   17   17  22.57 
02:05:43   0.2   0.0   0.3  99.2   0.3    1   3670   3489    0    0    1  21.66 
02:05:44   0.9   0.0   1.0  98.1   0.0    1   7495   4218   26   12   26  25.06 
02:05:45   0.1   0.0   0.2  99.6   0.1    1   3912   3617    0    0    0  22.92 
02:05:46   0.2   0.0   0.3  99.5   0.0    1   4003   3647    0    0    0  22.08 
02:05:47   0.3   0.0   0.3  99.5   0.0    1   3517   3503    0    0    0  21.97 
02:05:48   0.7   0.0   0.2  99.1   0.0    1   3942   3269    0    0    0  22.16 
02:05:49   0.4   0.0   0.2  99.4   0.0    1   4090   3304    0    0    0  21.91 
02:05:50   0.3   0.0   0.3  99.4   0.0    1   5428   4207    0    0    0  21.80 
02:05:51   0.3   0.0   0.3  99.5   0.0    1   3706   3412    0    0    1  21.80 
02:05:52   0.4   0.0   0.4  99.2   0.0    1   4158   3524   17   17   17  22.28 
02:05:53   0.4   0.0   0.2  99.3   0.1    1   4062   3484    0    0    0  21.84 
02:05:54   0.5   0.0   0.3  99.2   0.0    2   4608   3621   10    5   10  22.33 
02:05:55   1.2   0.0   1.0  97.9   0.0    2   6296   4078   16    7   16  24.18 
02:05:56   0.5   0.0   0.3  99.2   0.0    1   4204   3502    1    0    1  22.40 
  Time    User  Nice   Sys  Idle    IO  Run Ctxt/s  IRQ/s Fork Exec Exit  Watts
02:05:57   0.3   0.0   0.4  99.3   0.0    1   3769   3522    0    0    0  21.94 
02:05:58   0.3   0.0   0.3  99.4   0.0    1   4320   3661    0    0    0  21.93 
02:05:59   0.3   0.0   0.3  99.4   0.0    1   3761   3736    6    4    6  21.88 
02:06:00   0.3   0.0   0.2  99.6   0.0    1   4694   3634    1    0    0  22.20 
02:06:01   2.9   0.0   0.7  96.4   0.0    2   5291   4291   25   18   18  26.88 
02:06:02   0.4   0.0   0.3  99.3   0.0    1   3750   3058    0    0    0  21.64 
02:06:03   0.2   0.0   0.3  99.5   0.0    1   3857   3212    0    0    0  21.73 
02:06:04   0.2   0.0   0.4  99.3   0.1    1   3951   3473    0    0    0  21.99 
02:06:05   0.9   0.0   1.0  98.2   0.0    1   6419   4158   26   12   32  25.36 
02:06:06   0.4   0.0   0.3  99.4   0.0    1   4014   3579    0    0    0  22.64 
02:06:07   0.3   0.0   0.4  99.4   0.0    1   3911   3624    0    0    0  21.60 
02:06:08   0.3   0.0   0.2  99.5   0.0    2   3387   3484    0    0    2  21.45 
02:06:09   0.3   0.0   0.3  99.2   0.2    1   4258   3431    0    0    0  21.82 
02:06:10   0.4   0.0   0.1  99.5   0.0    1   4415   3857    0    0    0  22.11 
02:06:11   0.3   0.0   0.4  99.3   0.0    2   4386   3749   17   17   17  22.80 
02:06:12   0.5   0.0   0.3  99.2   0.0    1   3927   3398    0    0    0  22.20 
02:06:13   0.4   0.0   0.2  99.5   0.0    1   4206   3459    0    0    0  22.09 
02:06:14   0.5   0.0   0.8  98.5   0.1    2   6442   3647   16    7   15  23.91 
02:06:15   0.4   0.0   0.5  99.1   0.0    1   4710   3602   10    5   11  25.16 
02:06:16   0.3   0.0   0.4  99.2   0.0    1   3861   3587    0    0    0  21.86 
02:06:17   0.1   0.0   0.2  99.7   0.0    1   3036   3443    0    0    0  21.75 
02:06:18   0.3   0.0   0.3  99.5   0.0    1   3538   3273    0    0    0  21.94 
02:06:19   0.3   0.0   0.4  98.9   0.4    1   4244   3343    0    0    0  21.95 
02:06:20   0.4   0.0   0.3  99.4   0.0    1   4152   3660    0    0    0  21.79 
-------- ----- ----- ----- ----- ----- ---- ------ ------ ---- ---- ---- ------ 
 Average   0.4   0.0   0.4  99.2   0.0  1.2 4384.0 3635.6  4.6  3.0  4.6  22.42 
 GeoMean   0.3   0.0   0.3  99.2   0.0  1.1 4297.6 3623.8  0.0  0.0  0.0  22.39 
  StdDev   0.4   0.0   0.2   0.5   0.1  0.5  950.7  301.4  8.1  5.6  8.1   1.12 
-------- ----- ----- ----- ----- ----- ---- ------ ------ ---- ---- ---- ------ 
 Minimum   0.1   0.0   0.1  96.4   0.0  1.0 3036.0 3058.0  0.0  0.0  0.0  21.45 
 Maximum   2.9   0.0   1.0  99.7   0.4  3.0 7495.0 4656.0 26.0 18.0 32.0  26.88 
-------- ----- ----- ----- ----- ----- ---- ------ ------ ---- ---- ---- ------ 
Summary:
CPU:  22.42 Watts on average with standard deviation 1.12  
Note: power read from RAPL domains: package-0, dram.
These readings do not cover all the hardware in this device.

C-State    Resident      Count Latency 
C6          98.244%     280816     133
C3           0.210%      10455      33
C1E          0.052%       3929      10
C1           0.154%       6858       2
POLL         0.001%       4837       0
C0           1.339%
root@pve:~# 
``` 


### Monitoring in stress condition 
- I use stress tool to load a stress  ```stress -c 24 -i 13 -m 3```
- And using the same command to monitor usages "powerstat -R -c -z" 

### Emable all sample collection 

``` powerstat -a -R 1 60 ``` 

command prompt will show full details : 

```
root@pve:~# powerstat -a -R 1 60
Running for 60.0 seconds (60 samples at 1.0 second intervals).
Power measurements will start in 0 seconds time.

  Time    User  Nice   Sys  Idle    IO  Run Ctxt/s  IRQ/s Fork Exec Exit  Watts  x86_pk  CPU Freq  GPU W
02:12:50   0.3   0.0   0.2  99.5   0.0    1   6363   4418    0    0    0  22.24   46.00  2.10 GHz  -N/A-
02:12:51   0.2   0.0   0.3  99.5   0.0    1   4008   3416    0    0    0  21.71   45.00  2.06 GHz  -N/A-
02:12:52   0.3   0.0   0.5  98.6   0.6    1   4293   3774   17   17   17  22.09   44.00  2.12 GHz  -N/A-
02:12:53   0.2   0.0   0.3  99.5   0.0    1   4017   3239    0    0    0  21.40   45.00  2.09 GHz  -N/A-
02:12:54   0.6   0.0   0.5  98.9   0.0    1   6058   3651   15    6   14  22.77   44.00  2.15 GHz  -N/A-
02:12:55   0.6   0.0   0.6  98.8   0.0    1   5265   3781   11    6   12  25.72   44.00  2.14 GHz  -N/A-
02:12:56   0.3   0.0   0.3  99.4   0.0    1   3738   3538    0    0    0  22.23   45.00  2.06 GHz  -N/A-
02:12:57   0.3   0.0   0.3  99.2   0.2    1   4202   3223    0    0    0  21.97   45.00  2.05 GHz  -N/A-
02:12:58   0.3   0.0   0.3  99.5   0.0    1   3973   3265    0    0    0  21.92   45.00  2.05 GHz  -N/A-
02:12:59   0.3   0.0   0.4  99.2   0.0    1   4143   3192    0    0    0  22.09   46.00  2.05 GHz  -N/A-
02:13:00   0.3   0.0   0.4  99.4   0.0    1   6028   4369    6    4    6  22.07   46.00  2.12 GHz  -N/A-
02:13:01   2.8   0.0   0.5  96.7   0.0    2   4186   3706    7    1    0  25.45   46.00  2.02 GHz  -N/A-
02:13:02   0.4   0.0   0.5  98.7   0.4    1   5111   3922   18   17   18  22.96   46.00  2.14 GHz  -N/A-
02:13:03   0.3   0.0   0.3  99.5   0.0    1   4063   3518    0    0    0  22.04   45.00  2.06 GHz  -N/A-
02:13:04   0.2   0.0   0.4  99.4   0.0    1   4139   3421    0    0    0  22.08   45.00  2.03 GHz  -N/A-
02:13:05   1.0   0.0   1.3  97.7   0.0    1   6964   4457   26   12   32  23.99   45.00  1.81 GHz  -N/A-
02:13:06   0.4   0.0   0.2  99.5   0.0    1   4135   3450    0    0    0  21.93   45.00  2.06 GHz  -N/A-
02:13:07   0.2   0.0   0.3  99.5   0.0    1   3439   3430    0    0    0  22.03   46.00  2.06 GHz  -N/A-
02:13:08   0.2   0.0   0.4  99.4   0.0    1   4133   3426    0    0    0  22.20   45.00  2.04 GHz  -N/A-
02:13:09   0.3   0.0   0.3  99.4   0.0    1   4017   3409    0    0    0  22.07   45.00  2.03 GHz  -N/A-
02:13:10   0.3   0.0   0.5  99.2   0.0    1   6383   4493    0    0    0  22.33   45.00  2.05 GHz  -N/A-
02:13:11   0.3   0.0   0.3  99.4   0.0    1   3515   3497    0    0    0  21.85   45.00  2.05 GHz  -N/A-
02:13:12   0.4   0.0   0.4  99.2   0.0    1   4652   3549   17   17   17  22.76   46.00  2.09 GHz  -N/A-
02:13:13   0.3   0.0   0.3  99.4   0.0    2   3950   3276    0    0    0  21.91   45.00  2.08 GHz  -N/A-
02:13:14   0.2   0.0   0.4  99.4   0.0    2   3518   3593    0    0    2  21.98   44.00  2.02 GHz  -N/A-
02:13:15   0.8   0.0   0.9  98.2   0.1    2   6744   3938   22   10   22  24.05   45.00  2.21 GHz  -N/A-
02:13:16   0.5   0.0   0.5  99.0   0.0    1   4108   3583    4    2    4  23.47   44.00  2.10 GHz  -N/A-
02:13:17   0.3   0.0   0.2  99.5   0.0    1   4225   3577    0    0    0  21.91   44.00  2.03 GHz  -N/A-
02:13:18   0.3   0.0   0.2  99.3   0.3    1   4194   3625    0    0    0  22.09   45.00  2.06 GHz  -N/A-
02:13:19   0.4   0.0   0.4  99.2   0.0    1   4180   3499    0    0    0  22.01   44.00  2.05 GHz  -N/A-
02:13:20   0.2   0.0   0.4  99.4   0.0    1   6392   4366    0    0    0  22.21   45.00  2.04 GHz  -N/A-
02:13:21   0.3   0.0   0.3  99.5   0.0    1   3936   3502    0    0    0  22.02   45.00  2.03 GHz  -N/A-
02:13:22   0.4   0.0   0.5  99.1   0.0    1   4471   3799   17   17   17  22.69   45.00  2.11 GHz  -N/A-
02:13:23   0.4   0.0   0.3  99.2   0.1    1   3948   3555    0    0    0  22.28   46.00  2.08 GHz  -N/A-
02:13:24   0.2   0.0   0.3  99.5   0.0    1   3736   3518    0    0    0  22.01   45.00  2.02 GHz  -N/A-
02:13:25   0.8   0.0   0.9  98.3   0.1    2   6942   4400   26   12   26  25.64   45.00  2.15 GHz  -N/A-
  Time    User  Nice   Sys  Idle    IO  Run Ctxt/s  IRQ/s Fork Exec Exit  Watts  x86_pk  CPU Freq  GPU W
02:13:26   0.3   0.0   0.3  99.4   0.0    1   4014   3497    0    0    0  22.14   45.00  2.07 GHz  -N/A-
02:13:27   0.4   0.0   0.3  99.3   0.0    2   3687   3409    0    0    0  21.97   45.00  2.04 GHz  -N/A-
02:13:28   0.2   0.0   0.4  99.3   0.1    1   4033   3335    0    0    0  22.04   45.00  2.09 GHz  -N/A-
02:13:29   0.3   0.0   0.3  99.4   0.0    1   3636   3524    0    0    0  21.86   46.00  2.06 GHz  -N/A-
02:13:30   0.2   0.0   0.3  99.5   0.0    1   6127   4362    0    0    0  22.08   46.00  2.13 GHz  -N/A-
02:13:31   0.3   0.0   0.3  99.5   0.0    1   3640   3406    0    0    0  21.75   44.00  2.06 GHz  -N/A-
02:13:32   0.3   0.0   0.5  99.2   0.0    2   4338   3549   17   17   17  22.43   45.00  2.12 GHz  -N/A-
02:13:33   0.2   0.0   0.2  99.3   0.3    1   4104   3573    0    0    0  22.09   45.00  2.09 GHz  -N/A-
02:13:34   0.2   0.0   0.3  99.5   0.0    1   3759   3428    0    0    0  22.00   44.00  2.01 GHz  -N/A-
02:13:35   0.8   0.0   0.8  98.4   0.0    1   7282   4300   26   12   26  25.13   45.00  2.19 GHz  -N/A-
02:13:36   0.2   0.0   0.2  99.6   0.0    1   3793   3392    0    0    0  21.98   45.00  2.05 GHz  -N/A-
02:13:37   0.4   0.0   0.4  99.2   0.0    1   4309   3427    0    0    0  22.06   44.00  2.05 GHz  -N/A-
02:13:38   0.3   0.0   0.3  99.5   0.0    1   4202   3432    0    0    0  21.99   45.00  2.08 GHz  -N/A-
02:13:39   0.3   0.0   0.2  99.5   0.0    1   3855   3321    0    0    0  21.92   44.00  2.07 GHz  -N/A-
02:13:40   0.4   0.0   0.2  99.4   0.0    2   6243   4178    0    0    0  21.98   45.00  2.12 GHz  -N/A-
02:13:41   0.1   0.0   0.5  99.4   0.0    1   3795   3429    0    0    0  21.86   45.00  2.04 GHz  -N/A-
02:13:42   0.3   0.0   0.5  99.2   0.0    1   4002   3806   17   17   17  22.38   45.00  2.13 GHz  -N/A-
02:13:43   0.3   0.0   0.3  99.4   0.0    2   3837   3359    0    0    0  22.06   45.00  2.09 GHz  -N/A-
02:13:44   0.5   0.0   0.5  99.0   0.0    1   4243   3361    1    0    1  22.47   45.00  2.11 GHz  -N/A-
02:13:45   0.8   0.0   0.8  98.4   0.1    3   6669   3866   16    7   15  23.72   45.00  2.16 GHz  -N/A-
02:13:46   0.4   0.0   0.6  99.0   0.0    1   4709   3637   10    5   11  23.51   44.00  2.17 GHz  -N/A-
02:13:47   0.3   0.0   0.2  99.5   0.0    1   4115   3162    0    0    0  21.76   45.00  2.04 GHz  -N/A-
02:13:48   0.3   0.0   0.3  99.2   0.2    1   4220   3237    0    0    0  22.06   46.00  2.10 GHz  -N/A-
02:13:49   0.2   0.0   0.3  99.4   0.1    1   3629   3443    0    0    0  21.95   45.00  2.15 GHz  -N/A-
-------- ----- ----- ----- ----- ----- ---- ------ ------ ---- ---- ---- ------  ------ --------- ------
 Average   0.4   0.0   0.4  99.2   0.0  1.2 4556.8 3630.1  4.5  3.0  4.6  22.46   44.98  2.08 GHz  -N/A-
 GeoMean   0.3   0.0   0.4  99.2   0.0  1.1 4454.4 3613.9  0.0  0.0  0.0  22.44   44.98  2.08 GHz   0.00
  StdDev   0.4   0.0   0.2   0.5   0.1  0.4 1044.9  355.4  8.0  5.6  8.3   0.97    0.62  0.06 GHz  -N/A-
-------- ----- ----- ----- ----- ----- ---- ------ ------ ---- ---- ---- ------  ------ --------- ------
 Minimum   0.1   0.0   0.2  96.7   0.0  1.0 3439.0 3162.0  0.0  0.0  0.0  21.40   44.00  1.81 GHz  -N/A-
 Maximum   2.8   0.0   1.3  99.6   0.6  3.0 7282.0 4493.0 26.0 17.0 32.0  25.72   46.00  2.21 GHz  -N/A-
-------- ----- ----- ----- ----- ----- ---- ------ ------ ---- ---- ---- ------  ------ --------- ------
Summary:
CPU:  22.46 Watts on average with standard deviation 0.97  
GPU:   0.00 Watts on average with standard deviation 0.00  
Note: power read from RAPL domains: package-0, dram.
These readings do not cover all the hardware in this device.

C-State    Resident      Count Latency 
C6          98.425%     284845     133
C3           0.157%       8111      33
C1E          0.047%       3566      10
C1           0.131%       6178       2
POLL         0.001%       6664       0
C0           1.239%

Histogram (of 60 power measurements)

 Range (Watts)  Count
21.398 - 21.830     4 ####
21.831 - 22.262    38 ########################################
22.263 - 22.694     6 ######
22.695 - 23.127     3 ###
23.128 - 23.559     2 ##
23.560 - 23.992     1 #
23.993 - 24.424     2 ##
24.425 - 24.856     0 
24.857 - 25.289     1 #
25.290 - 25.721     3 ###

Histogram (of 60 CPU utilization measurements)

Range (%CPU)  Count
0.419 - 0.707    34 ########################################
0.708 - 0.996    15 #################
0.997 - 1.285     3 ###
1.286 - 1.574     2 ##
1.575 - 1.862     4 ####
1.863 - 2.151     0 
2.152 - 2.440     1 #
2.441 - 2.729     0 
2.730 - 3.018     0 
3.019 - 3.307     1 #

Histogram (of 60 CPU average frequencies)

Range (GHz)   Count
1.809 - 1.848     1 ##
1.849 - 1.887     0 
1.888 - 1.927     0 
1.928 - 1.967     0 
1.968 - 2.007     0 
2.008 - 2.047    14 ############################
2.048 - 2.086    20 ########################################
2.087 - 2.126    14 ############################
2.127 - 2.166     8 ################
2.167 - 2.206     3 ######

Histogram (of 60 thermal zone x86_pkg_temp readings)

 Range (°C)    Count
44.000 - 44.199    12 ############
44.200 - 44.399     0 
44.400 - 44.599     0 
44.600 - 44.799     0 
44.800 - 44.999    37 ########################################
45.000 - 45.199     0 
45.200 - 45.399     0 
45.400 - 45.599     0 
45.600 - 45.799     0 
45.800 - 45.999    11 ###########

```

### Complete help manual 

```
root@pve:~# powerstat -h
powerstat, version 0.02.18

usage: powerstat [options] [delay [count]]
        -a enable all sampling collection options (-c, -f, -t and -H)
        -b redo a sample if a system is busy, considered less than 98% CPU idle
        -c show C-State statistics at end of the run
        -d specify delay before starting, default is 180 seconds
        -D show RAPL domain power measurements (enables -R option)
        -f show average CPU frequency
        -g show GPU power (currently just i915)
        -h show help
        -H show spread of measurements with power histogram
        -i specify CPU idle threshold, used in conjunction with -b
        -n no printing of table heading when screen scrolls
        -p redo a sample if we see process fork/exec/exit activity
        -r redo a sample if busy and we see process activity (same as -b -p)
        -R gather stats from Intel RAPL interface
        -s show process fork/exec/exit activity log
        -S calculate power from capacity drain using standard average
        -t show Thermal Zone temperatures (in degrees C)
        -z forcibly ignore zero power rate stats from the battery
        delay: delay between each sample, default is 10.0 seconds
        count: number of samples to take
        
  ```
